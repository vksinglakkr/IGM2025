<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AskGita – International Gita Mahotsav 2025</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
 <style>
  body {
    background: linear-gradient(135deg, #e0f7ff 0%, #c0e7ff 100%);
    font-family: 'Inter', sans-serif;
  }

  .saffron { background-color: #FF9933; }
  .white { background-color: #FFFFFF; }
  .green { background-color: #138808; }
  .cinzel { font-family: 'Cinzel', serif; }

  .mandala-bg {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 200 200'%3E%3Ccircle cx='100' cy='100' r='90' fill='none' stroke='%23FF9933' stroke-width='0.5' opacity='0.1'/%3E%3Ccircle cx='100' cy='100' r='70' fill='none' stroke='%23138808' stroke-width='0.5' opacity='0.1'/%3E%3C/svg%3E");
    background-size: 300px;
  }

  /* TTS Animation Styles */
  .wave-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    height: 40px;
  }

  .wave-bar {
    width: 4px;
    background: linear-gradient(to top, #FF9933, #138808);
    border-radius: 4px;
    animation: wave 1.2s ease-in-out infinite;
  }

  .wave-bar:nth-child(1) { animation-delay: 0s; }
  .wave-bar:nth-child(2) { animation-delay: 0.1s; }
  .wave-bar:nth-child(3) { animation-delay: 0.2s; }
  .wave-bar:nth-child(4) { animation-delay: 0.3s; }
  .wave-bar:nth-child(5) { animation-delay: 0.4s; }

  @keyframes wave {
    0%, 100% { height: 10px; }
    50% { height: 40px; }
  }

  .tts-controls {
    background: linear-gradient(135deg, #FFF5E6 0%, #FFE4B3 100%);
    border: 2px solid #FF9933;
  }

  .voice-select {
    background: white;
    border: 2px solid #FFB84D;
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 14px;
  }

  .speaking-indicator {
    display: none;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: linear-gradient(90deg, #FF9933 0%, #FFB84D 100%);
    color: white;
    border-radius: 20px;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(255, 153, 51, 0.4);
  }

  .speaking-indicator.active {
    display: flex;
  }

  .speed-control {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .speed-btn {
    padding: 4px 12px;
    border-radius: 6px;
    border: 2px solid #FFB84D;
    background: white;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .speed-btn:hover {
    background: #FFF5E6;
  }

  .speed-btn.active {
    background: #FF9933;
    color: white;
    border-color: #FF9933;
  }
</style>

</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 mandala-bg">

  <div class="w-full max-w-4xl bg-white/80 backdrop-blur-sm rounded-3xl shadow-2xl overflow-hidden border-2 border-amber-200">
    <div class="relative bg-white p-6 text-center rounded-3xl shadow-[0_6px_20px_rgba(0,0,0,0.25)] border-4 border-amber-500 max-w-4xl mx-auto mt-1">
      <div class="absolute inset-0 rounded-3xl border border-yellow-400 opacity-60"></div>
      <h1 class="text-6xl md:text-6xl font-extrabold text-amber-800 drop-shadow-[2px_2px_4px_rgba(0,0,0,0.4)] tracking-wide">
        AskGita <span class="text-black text-2xl"></span>
      </h1>
      <div class="mt-3 bg-amber-50 rounded-xl border-2 border-amber-400 inline-block px-5 py-2 shadow-inner">
        <h2 class="text-1xl font-bold text-amber-800 drop-shadow-sm">
          International Gita Mahotsav - 2025 <span class="text-black text-xl"></span>
        </h2>
      </div>
    </div>

<div class="p-4 pt-3 pb-2"> <div class="mb-1"> <label class="block text-base font-semibold text-amber-800 mb-1">
      Ask Question ... 
    </label>

    <div class="relative">
<textarea 
  id="userInput"
  rows="2"
  class="w-full rounded-xl border-2 border-amber-400 p-3 pr-12 text-gray-900 text-lg
         bg-gradient-to-r from-amber-50 via-yellow-50 to-amber-100
         shadow-inner placeholder-gray-500 resize-none
         focus:border-amber-600 focus:ring-4 focus:ring-amber-200 focus:shadow-lg focus:shadow-amber-200/50
         transition duration-300 ease-in-out leading-snug min-h-[72px]"
  placeholder="Type here to explore ... Gita, Mahabharata, or Kurukshetra"
></textarea>

      <button 
        id="voiceBtn" 
        class="absolute inset-y-0 right-3 flex items-center text-gray-500 hover:text-green-600"
        title="Speak your question"
      >
        <i data-lucide="mic" class="w-5 h-5"></i>
      </button>
    </div>

    <div class="flex flex-wrap gap-2 mt-2"> <button class="langBtn px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition active" data-lang="Hindi">
        हिंदी
      </button>
      <button class="langBtn px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition" data-lang="English">
        English
      </button>
      <button 
        id="submitBtn" 
        class="flex items-center justify-center gap-2 bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg transition flex-1"
      >
        <i data-lucide="send" class="w-4 h-4"></i> Send
      </button>
    </div>
  </div>
</div>

<div class="mt-0 mb-1 px-6">
    <div class="flex items-center justify-between mb-1">
        <label class="block text-sm font-medium text-gray-700">Or Select a Ready Question</label>
        <div class="flex items-center">
            <button id="musicToggle" class="text-sm text-gray-600 hover:text-amber-700 flex items-center gap-1">
                <i data-lucide="music" class="w-4 h-4"></i>
                <span id="musicLabel">Play Flute</span>
            </button>
        </div>
    </div>
    
    <div class="space-y-2">
        <select id="categorySelect" class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md bg-gray-50">
            <option value="" selected disabled>--- Select Main Category ---</option>
            <option value="PHILOSOPHICAL_QUERY">1. Gita Wisdom / Philosophy</option>
            <option value="EVENT_QUERY">2. Event Schedule & Activities</option>
            <option value="FACILITY_QUERY">3. Amenities & Facilities</option>
            <option value="TRANSPORT_QUERY">4. Transport & Travel</option>
            <option value="GENERAL_INFO">5. General Festival Info</option>
            <option value="TOURISM_QUERY">6. Tourist Places & Sightseeing</option>
            <option value="ACCOMMODATION_QUERY">7. Accommodation & Stay</option>
            <option value="COMPETITION_QUERY">8. Competitions & Registration</option>
            <option value="EMERGENCY_QUERY">9. Emergency & Helpline</option>
            <option value="FAQ_QUERY">10. Common Questions (FAQ)</option>
        </select>

        <select id="questionSelect" class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md bg-gray-50" disabled>
            <option value="" selected disabled>--- Select Question ---</option>
        </select>
    </div>
</div>
<div class="px-6 py-3 grid grid-cols-1 md:grid-cols-3 gap-3"> <div class="bg-blue-50 border-l-4 border-l-blue-500 rounded-xl p-2 text-center">
        <p class="font-bold text-gray-800">Exhibition</p>
        <p class="text-sm text-gray-700">15 Nov – 5 Dec 2025</p>
      </div>
      <div class="bg-amber-50 border-l-4 border-l-amber-500 rounded-xl p-2 text-center">
        <p class="font-bold text-gray-800">Daily Quiz</p>
        <p class="text-sm text-gray-700">4 – 14 Nov 2025</p>
      </div>
      <div class="bg-green-50 border-l-4 border-l-green-500 rounded-xl p-2 text-center">
        <p class="font-bold text-gray-800">Cultural Programs</p>
        <p class="text-sm text-gray-700">24 Nov – 1 Dec 2025</p>
      </div>
    </div>

    <div class="bg-blue-50 border-l-4 border-blue-600 p-4 mx-6 mt-2 rounded-r-lg">
      <p class="text-lg italic text-gray-800 font-serif text-center">
        "ज्ञानं तेऽहं सविज्ञानमिदं वक्ष्याम्यशेषतः।<br>
        यज्ज्ञात्वा नेह भूयोऽन्यज्ज्ञातव्यमवशिष्यते॥"
      </p>
      <p class="text-right text-gray-600 mt-1">– श्रीमद्भगवद्गीता, अध्याय 7, श्लोक 2</p>
      <p class="text-center text-sm text-gray-700 mt-2 font-medium">
        "I shall now declare to you in full this knowledge with realization, knowing which nothing else remains to be known in this world."
      </p>
    </div>

      <div class="mt-4 text-center">
        <a href="index.html" class="text-blue-600 hover:text-blue-800 flex items-center justify-center gap-1">
          <i data-lucide="home" class="w-4 h-4"></i> Return to Main Page
        </a>
      </div>
    </div>

    <div class="border-t-2 border-gray-200 p-4 text-center">
      <p class="text-sm text-gray-700 italic mt-3">
        AI Chatbot powered by <span class="font-semibold text-amber-800">Groq + Llama 3.3</span>
      </p>

      <p class="text-gray-600 text-sm">
        International Gita Mahotsav 2025<br>
        Designed & Maintained by NIC, Kurukshetra
      </p>
      <p class="text-center text-gray-500 text-xs mt-2">
        Last Updated: <span id="lastModified"></span>
      </p>
      <div class="flex flex-wrap justify-center items-center gap-6 mt-3">
        <img src="https://raw.githubusercontent.com/vksinglakkr/IGM2025/main/Images/haryana-logo.jpg" alt="Government of Haryana" class="w-12 h-12 object-contain">
        <img src="https://raw.githubusercontent.com/vksinglakkr/IGM2025/main/Images/kdb-logo.png" alt="Kurukshetra Development Board" class="w-12 h-12 object-contain">
        <img src="https://raw.githubusercontent.com/vksinglakkr/IGM2025/main/Images/nicLogo.png" alt="National Informatics Centre" class="w-12 h-12 object-contain">
      </div>
    </div>
  </div>

  <div id="aiModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 fade-in">
      <div class="flex justify-between items-center border-b px-5 py-3 bg-blue-700 text-white rounded-t-2xl">
        <h2 class="text-lg font-semibold flex items-center gap-2">
          <i data-lucide="message-circle" class="w-5 h-5"></i> AI Response
        </h2>
        <button id="closeModal" class="hover:text-gray-200">
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>
      </div>

      <!-- TTS Controls Section -->
      <div class="tts-controls p-4 border-b">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <div class="flex items-center gap-2">
            <button id="playTTS" class="flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition font-semibold shadow-md">
              <i data-lucide="volume-2" class="w-4 h-4"></i>
              <span>Play</span>
            </button>
            <button id="pauseTTS" class="flex items-center gap-2 px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg transition font-semibold shadow-md" disabled>
              <i data-lucide="pause" class="w-4 h-4"></i>
              <span>Pause</span>
            </button>
            <button id="stopTTS" class="flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition font-semibold shadow-md" disabled>
              <i data-lucide="square" class="w-4 h-4"></i>
              <span>Stop</span>
            </button>
          </div>

          <div class="speed-control">
            <span class="text-sm font-semibold text-gray-700">Speed:</span>
            <button class="speed-btn" data-speed="0.75">0.75x</button>
            <button class="speed-btn active" data-speed="1">1x</button>
            <button class="speed-btn" data-speed="1.25">1.25x</button>
            <button class="speed-btn" data-speed="1.5">1.5x</button>
          </div>
        </div>

        <!-- Speaking Indicator with Animation -->
        <div id="speakingIndicator" class="speaking-indicator mt-3">
          <div class="wave-container">
            <div class="wave-bar"></div>
            <div class="wave-bar"></div>
            <div class="wave-bar"></div>
            <div class="wave-bar"></div>
            <div class="wave-bar"></div>
          </div>
          <span>Speaking...</span>
        </div>

        <!-- Voice Selection -->
        <div class="mt-3">
          <label class="text-sm font-semibold text-gray-700 mr-2">Voice:</label>
          <select id="voiceSelect" class="voice-select">
            <option value="">Loading voices...</option>
          </select>
        </div>
      </div>

      <div class="p-5 max-h-[60vh] overflow-y-auto">
        <p class="font-semibold text-gray-700 mb-2">Question:</p>
        <pre id="modalQuestion" class="whitespace-pre-wrap text-gray-800 mb-4 bg-blue-50 p-3 rounded-lg"></pre>
        <p class="font-semibold text-gray-700 mb-2">Answer:</p>
        <pre id="modalAnswer" class="whitespace-pre-wrap text-gray-800 bg-amber-50 p-3 rounded-lg"></pre>
      </div>
      <div class="border-t p-4 flex justify-end gap-3">
        <button id="copyBtn" class="flex items-center gap-1 px-4 py-2 border rounded-lg hover:bg-gray-100 transition">
          <i data-lucide="copy" class="w-4 h-4"></i> Copy
        </button>
        <a href="index.html" class="flex items-center gap-1 px-4 py-2 border rounded-lg hover:bg-gray-100 transition">
          <i data-lucide="home" class="w-4 h-4"></i> Main Page
        </a>
        <button id="closeBtn" class="bg-blue-700 text-white px-5 py-2 rounded-lg hover:bg-blue-800 transition">
          Close
        </button>
      </div>
    </div>
  </div>
<audio id="fluteMusic" loop>
  <source src="https://vksinglakkr.github.io/IGM2025/audio/gentle-flute.mp3" type="audio/mpeg">
  Your browser does not support audio.
</audio>
  <script>
    
const categoryQuestions = {
    'PHILOSOPHICAL_QUERY': [
        "How can one control anger according to the Bhagavad Gita?",
        "What does the Gita say about finding peace of mind?",
        "How can a person stay calm in success and failure as per the Gita?",
        "What guidance does the Gita give for overcoming fear and anxiety?",
        "How can one control desires and attachments according to Lord Krishna?",
        "What is the ultimate message of the Bhagavad Gita for a common person?",
    ],
    'EVENT_QUERY': [
        "What are the dates for the PM/CM/Governor visits? (VVIP_Visits)",
        "When is the main Gita Path ceremony scheduled? (Spiritual_Activities)",
        "What cultural programs are scheduled for tomorrow? (Cultural_Programs)",
        "Tell me about the art and book exhibitions. (Exhibitions)",
        "What time is the Deep Daan ceremony today? (Religious_Events)",
        "I want to participate in the debate competition. (Competitions)",
    ],
    'FACILITY_QUERY': [
        "Where is the nearest parking and is it free?",
        "Where can I find the food court or canteen?",
        "Are there any medical or first aid facilities near the main stage?",
        "Where is the Lost and Found counter?",
    ],
    'TRANSPORT_QUERY': [
        "What's the best way to reach Kurukshetra from Delhi by train?",
        "Are there shuttle bus services available during the festival?",
        "Where is the nearest taxi stand?",
    ],
    'GENERAL_INFO': [
        "What are the dates and timings for the Gita Mahotsav 2025?",
        "What is the official helpline number?",
        "Are there any entry fees for the main fair grounds?",
    ],
    'TOURISM_QUERY': [
        "What are the timings for Jyotisar and Brahma Sarovar?",
        "Can you suggest a sightseeing tour itinerary for the day?",
        "What is the historical significance of Krishna Museum?",
    ],
    'ACCOMMODATION_QUERY': [
        "Are there budget hotels available near the venue?",
        "How can I book a room in a nearby Dharamshala?",
        "Where can I find information on homestays?",
    ],
    'COMPETITION_QUERY': [
        "How do I register for the Gita Chanting competition?",
        "What are the eligibility criteria for the essay contest?",
        "What is the prize information for the painting contest?",
    ],
    'EMERGENCY_QUERY': [
        "What are the emergency contact numbers for the festival?",
        "Where is the police station or medical emergency center located?",
        "I have lost my child, where should I report it?",
    ],
    'FAQ_QUERY': [
        "What is the Gita Mahotsav?",
        "What are the general rules and regulations for visitors?",
        "What is the predicted weather forecast for the next week?",
    ]
};

    lucide.createIcons();

    document.getElementById("lastModified").textContent = new Date(document.lastModified).toLocaleString('en-US', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: false
    });

    const categorySelect = document.getElementById('categorySelect');
    const questionSelect = document.getElementById('questionSelect');
    const userQueryInput = document.getElementById('userInput');

    function populateQuestions(category) {
        questionSelect.innerHTML = '<option value="" selected disabled>--- Select Question ---</option>';
        questionSelect.disabled = true;

        if (category && categoryQuestions[category]) {
            const questions = categoryQuestions[category];
            questions.forEach(q => {
                const option = document.createElement('option');
                option.value = q;
                option.textContent = q;
                questionSelect.appendChild(option);
            });
            questionSelect.disabled = false;
        }
    }

    if (categorySelect) {
        categorySelect.addEventListener('change', () => {
            const selectedCategory = categorySelect.value;
            populateQuestions(selectedCategory);
            if (userQueryInput) userQueryInput.value = '';
        });
    }

    if (questionSelect && userQueryInput) {
        questionSelect.addEventListener('change', () => {
            userQueryInput.value = questionSelect.value;
        });
    }

    let selectedLanguage = 'Hindi';
    document.querySelectorAll('.langBtn').forEach(btn => {
      btn.addEventListener('click', function() {
        selectedLanguage = this.dataset.lang;
        document.querySelectorAll('.langBtn').forEach(b => b.classList.replace('bg-blue-600', 'bg-gray-600'));
        this.classList.replace('bg-gray-600', 'bg-blue-600');
      });
    });

    // ===== TEXT-TO-SPEECH FUNCTIONALITY =====
    let ttsUtterance = null;
    let ttsVoices = [];
    let currentSpeed = 1;

    function loadVoices() {
        ttsVoices = speechSynthesis.getVoices();
        const voiceSelect = document.getElementById('voiceSelect');
        voiceSelect.innerHTML = '';
        
        const hindiVoices = ttsVoices.filter(v => v.lang.startsWith('hi'));
        const englishVoices = ttsVoices.filter(v => v.lang.startsWith('en'));
        
        if (hindiVoices.length > 0) {
            const hindiGroup = document.createElement('optgroup');
            hindiGroup.label = 'Hindi Voices';
            hindiVoices.forEach((voice, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = voice.name;
                hindiGroup.appendChild(option);
            });
            voiceSelect.appendChild(hindiGroup);
        }
        
        if (englishVoices.length > 0) {
            const englishGroup = document.createElement('optgroup');
            englishGroup.label = 'English Voices';
            englishVoices.forEach((voice, index) => {
                const option = document.createElement('option');
                option.value = ttsVoices.indexOf(voice);
                option.textContent = voice.name;
                englishGroup.appendChild(option);
            });
            voiceSelect.appendChild(englishGroup);
        }
    }

    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = loadVoices;
    }
    loadVoices();

    document.getElementById('playTTS').addEventListener('click', () => {
        const answerText = document.getElementById('modalAnswer').textContent;
        if (answerText && answerText !== 'Thinking...') {
            if (speechSynthesis.paused) {
                speechSynthesis.resume();
            } else {
                speechSynthesis.cancel();
                ttsUtterance = new SpeechSynthesisUtterance(answerText);
                
                const selectedVoiceIndex = document.getElementById('voiceSelect').value;
                if (selectedVoiceIndex) {
                    ttsUtterance.voice = ttsVoices[selectedVoiceIndex];
                }
                
                ttsUtterance.rate = currentSpeed;
                ttsUtterance.pitch = 1;
                ttsUtterance.volume = 1;
                
                ttsUtterance.onstart = () => {
                    document.getElementById('speakingIndicator').classList.add('active');
                    document.getElementById('playTTS').disabled = true;
                    document.getElementById('pauseTTS').disabled = false;
                    document.getElementById('stopTTS').disabled = false;
                };
                
                ttsUtterance.onend = () => {
                    document.getElementById('speakingIndicator').classList.remove('active');
                    document.getElementById('playTTS').disabled = false;
                    document.getElementById('pauseTTS').disabled = true;
                    document.getElementById('stopTTS').disabled = true;
                };
                
                speechSynthesis.speak(ttsUtterance);
            }
        }
    });

    document.getElementById('pauseTTS').addEventListener('click', () => {
        if (speechSynthesis.speaking) {
            speechSynthesis.pause();
            document.getElementById('speakingIndicator').classList.remove('active');
        }
    });

    document.getElementById('stopTTS').addEventListener('click', () => {
        speechSynthesis.cancel();
        document.getElementById('speakingIndicator').classList.remove('active');
        document.getElementById('playTTS').disabled = false;
        document.getElementById('pauseTTS').disabled = true;
        document.getElementById('stopTTS').disabled = true;
    });

    document.querySelectorAll('.speed-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.speed-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            currentSpeed = parseFloat(this.dataset.speed);
            
            if (ttsUtterance && speechSynthesis.speaking) {
                const currentText = ttsUtterance.text;
                speechSynthesis.cancel();
                setTimeout(() => {
                    document.getElementById('playTTS').click();
                }, 100);
            }
        });
    });

    document.getElementById('submitBtn').addEventListener('click', async () => {
      const question = document.getElementById('userInput').value.trim();
      if (!question) return;

      speechSynthesis.cancel();

      document.getElementById('modalQuestion').textContent = question;
      document.getElementById('modalAnswer').textContent = 'Thinking...';
      document.getElementById('aiModal').classList.remove('hidden');
      document.getElementById('playTTS').disabled = true;

      try {
        const response = await fetch('https://aarvisingla1609.app.n8n.cloud/webhook/ask-gita', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            question: question,
            language: selectedLanguage,
            mobNo: 'anonymous'
          })
        });

        const data = await response.json();
        document.getElementById('modalAnswer').textContent = data.answer || data.error || 'No response received.';
        document.getElementById('playTTS').disabled = false;
      } catch (error) {
        document.getElementById('modalAnswer').textContent = 'Connection failed: ' + error.message;
        document.getElementById('playTTS').disabled = false;
      }
      
      lucide.createIcons();
    });

    let recognition;
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'hi-IN';

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById('userInput').value = transcript;
      };
    }

    document.getElementById('voiceBtn').addEventListener('click', () => {
      if (recognition) recognition.start();
    });

    document.getElementById('closeBtn').onclick = () => {
      speechSynthesis.cancel();
      document.getElementById('aiModal').classList.add('hidden');
    };
    
    document.getElementById('closeModal').onclick = () => {
      speechSynthesis.cancel();
      document.getElementById('aiModal').classList.add('hidden');
    };
    
    document.getElementById('copyBtn').onclick = () => {
      const text = document.getElementById('modalAnswer').textContent;
      navigator.clipboard.writeText(text).then(() => {
        const original = document.getElementById('copyBtn').innerHTML;
        document.getElementById('copyBtn').innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Copied!';
        lucide.createIcons();
        setTimeout(() => {
          document.getElementById('copyBtn').innerHTML = original;
          lucide.createIcons();
        }, 2000);
      });
    };

    const fluteMusic = document.getElementById('fluteMusic');
    const musicToggle = document.getElementById('musicToggle');
    const musicLabel = document.getElementById('musicLabel');

    musicToggle.addEventListener('click', () => {
      if (fluteMusic.paused) {
        fluteMusic.play().catch(e => {
          console.warn("Audio play blocked by browser autoplay policy:", e);
          alert("Please interact with the page first, then click to play music.");
        });
        musicLabel.textContent = "Pause Flute";
      } else {
        fluteMusic.pause();
        musicLabel.textContent = "Play Flute";
      }
    });

    lucide.createIcons();
    
  </script>
  
</body>
</html>
