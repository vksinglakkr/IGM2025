<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IGM Mitra ‚Äì International Gita Mahotsav 2025</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&family=Playfair+Display:wght@700;900&family=Noto+Sans+Devanagari:wght@400;500;600;700&display=swap" rel="stylesheet">
 <style>
  * { margin: 0; padding: 0; box-sizing: border-sizing: border-box; }
  body {
    background: radial-gradient(ellipse at top, #1e3a8a, #0f172a);
    font-family: 'Poppins', sans-serif;
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
  }
  body::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background-image: 
      radial-gradient(circle at 20% 50%, rgba(251, 191, 36, 0.1) 0%, transparent 50%),
      radial-gradient(circle at 80% 80%, rgba(249, 115, 22, 0.1) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }
  .devanagari { font-family: 'Noto Sans Devanagari', sans-serif; }
  .playfair { font-family: 'Playfair Display', serif; }
  .container-main { position: relative; z-index: 1; }
  .glass-card {
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;
  }
  .gradient-text {
    background: linear-gradient(135deg, #ff6b35 0%, #f59e0b 50%, #ff6b35 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    background-size: 200% auto;
    animation: shimmer 3s linear infinite;
  }
  .mic-btn {
    transition: all 0.3s;
    -webkit-tap-highlight-color: transparent;
  }
  .mic-btn.recording {
    background: linear-gradient(135deg, #dc2626, #ef4444) !important;
    border-color: #dc2626 !important;
    animation: pulseRec 1.5s ease-in-out infinite;
  }
  @keyframes pulseRec {
    0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
    50% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); }
  }
  @keyframes shimmer { to { background-position: 200% center; } }
  .header-glow { position: relative; }
  .header-glow::before {
    content: '';
    position: absolute;
    top: -20px; left: 50%;
    transform: translateX(-50%);
    width: 200px; height: 200px;
    background: radial-gradient(circle, rgba(251, 191, 36, 0.3), transparent 70%);
    filter: blur(40px);
    pointer-events: none;
  }
  .tts-btn {
    padding: 8px 16px;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    border: none;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .tts-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
  .tts-btn.speaking { animation: pulse 1.5s ease-in-out infinite; }
  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.8; transform: scale(1.05); }
  }
  .lang-toggle {
    display: inline-flex;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 12px;
    padding: 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  .lang-toggle button {
    padding: 8px 20px;
    border-radius: 10px;
    transition: all 0.3s;
    font-size: 14px;
    font-weight: 600;
    border: none;
    background: transparent;
    cursor: pointer;
  }
  .lang-toggle button.active {
    background: linear-gradient(135deg, #ff6b35, #f59e0b);
    color: white;
    box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
  }
  .lang-toggle button:not(.active) {
    color: #64748b;
  }
  #autocompleteDropdown {
    max-height: 400px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 107, 53, 0.3) transparent;
  }
  #autocompleteDropdown::-webkit-scrollbar {
    width: 6px;
  }
  #autocompleteDropdown::-webkit-scrollbar-track {
    background: transparent;
  }
  #autocompleteDropdown::-webkit-scrollbar-thumb {
    background: rgba(255, 107, 53, 0.3);
    border-radius: 3px;
  }
  .autocomplete-item {
    padding: 12px 16px;
    cursor: pointer;
    transition: all 0.2s;
    border-left: 3px solid transparent;
  }
  .autocomplete-item:hover {
    background: linear-gradient(90deg, rgba(255, 107, 53, 0.1), transparent);
    border-left-color: #ff6b35;
    transform: translateX(3px);
  }
  .autocomplete-item mark {
    background: linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(245, 158, 11, 0.2));
    color: #dc2626;
    font-weight: 600;
    padding: 2px 4px;
    border-radius: 4px;
  }
  .autocomplete-category {
    padding: 8px 16px;
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(245, 158, 11, 0.1));
    color: #ff6b35;
    border-left: 4px solid #ff6b35;
    margin-top: 4px;
  }
  .autocomplete-no-results {
    padding: 16px;
    text-align: center;
    color: #64748b;
    font-style: italic;
  }
  @media (max-width: 768px) {
    .header-glow::before { display: none; }
    .lang-toggle button { padding: 6px 14px; font-size: 13px; }
  }
 </style>
</head>
<body>

<audio id="fluteMusic" loop>
  <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
</audio>

<div class="container-main max-w-7xl mx-auto px-4 py-8">

  <div class="text-center mb-10">
    <div class="header-glow inline-block mb-6">
      <div class="flex items-center justify-center gap-4 mb-4">
        <svg class="w-16 h-16 md:w-20 md:h-20 text-amber-500" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5zm0 18c-4 0-7-3-7-7V8.3l7-3.5 7 3.5V13c0 4-3 7-7 7z"/>
          <path d="M10 17l-3-3 1.41-1.41L10 14.17l5.59-5.58L17 10l-7 7z"/>
        </svg>
      </div>
      <h1 class="text-4xl md:text-5xl lg:text-6xl font-black playfair gradient-text mb-3">
        IGM Mitra
      </h1>
      <p class="text-xl md:text-2xl text-amber-100 font-semibold devanagari mb-1">
        ‡§Ü‡§à‡§ú‡•Ä‡§è‡§Æ ‡§Æ‡§ø‡§§‡•ç‡§∞
      </p>
      <p class="text-base md:text-lg text-gray-300 font-medium">
        Your Guide to International Gita Mahotsav 2025
      </p>
    </div>

    <div class="lang-toggle mx-auto mb-6">
      <button class="langBtn active" data-lang="Hindi" id="hindiBtn">
        <span class="devanagari">‡§π‡§ø‡§Ç‡§¶‡•Ä</span>
      </button>
      <button class="langBtn" data-lang="English" id="englishBtn">
        English
      </button>
    </div>

    <div class="mb-6">
      <button id="musicToggle" class="px-6 py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-full font-semibold shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105">
        <span id="musicLabel">üéµ Play Flute Music</span>
      </button>
    </div>
  </div>

  <div class="glass-card rounded-3xl p-8 md:p-10 mb-10 shadow-2xl">
    
    <div class="mb-8">
      <h2 class="text-2xl md:text-3xl font-bold mb-6 text-center">
        <span class="gradient-text playfair">Ask Your Question</span>
      </h2>

      <div class="space-y-6">
        
        <!-- Category Dropdown -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-3">
            üéØ Select Topic
          </label>
          <select id="categorySelect" class="block w-full px-5 py-4 text-base border-2 border-gray-200 focus:outline-none focus:ring-3 focus:ring-blue-500 focus:border-blue-500 rounded-2xl bg-white shadow-md transition-all duration-300 font-medium">
            <option value="" selected disabled>Select Topic</option>
          </select>
        </div>

        <!-- Question Dropdown -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-3">
            ‚ùì Select Question
          </label>
          <select id="questionSelect" disabled class="block w-full px-5 py-4 text-base border-2 border-gray-200 focus:outline-none focus:ring-3 focus:ring-blue-500 focus:border-blue-500 rounded-2xl bg-white shadow-md transition-all duration-300 font-medium disabled:bg-gray-100 disabled:cursor-not-allowed">
            <option value="" selected disabled>First select a topic</option>
          </select>
        </div>

        <!-- OR Divider -->
        <div class="relative flex items-center justify-center my-6">
          <div class="border-t border-gray-300 w-full"></div>
          <span class="absolute bg-white px-4 text-sm font-semibold text-gray-500">OR</span>
        </div>

        <!-- Text Input with Autocomplete -->
        <div class="relative">
          <label class="block text-sm font-semibold text-gray-700 mb-3">
            ‚úçÔ∏è Type Your Question
          </label>
          <div class="relative">
            <input
              type="text"
              id="userInput"
              placeholder="e.g., ‡§ó‡•Ä‡§§‡§æ ‡§ú‡§Ø‡§Ç‡§§‡•Ä ‡§ï‡§¨ ‡§π‡•à?"
              class="block w-full px-5 py-4 text-base border-2 border-gray-200 focus:outline-none focus:ring-3 focus:ring-blue-500 focus:border-blue-500 rounded-2xl bg-white shadow-md transition-all duration-300 font-medium pr-16"
              autocomplete="off"
            />
            <button
              id="micBtn"
              class="mic-btn absolute right-3 top-1/2 transform -translate-y-1/2 w-10 h-10 flex items-center justify-center rounded-full bg-gradient-to-r from-red-500 to-pink-500 text-white border-2 border-red-600 shadow-lg hover:shadow-xl"
              title="Voice Input"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
              </svg>
            </button>
          </div>

          <!-- Autocomplete Dropdown -->
          <div id="autocompleteDropdown" class="absolute z-50 w-full mt-2 bg-white border-2 border-gray-200 rounded-2xl shadow-2xl hidden"></div>
        </div>

        <!-- Submit Button -->
        <button
          id="submitBtn"
          class="w-full py-4 px-6 text-lg font-bold bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-2xl shadow-xl hover:shadow-2xl hover:scale-[1.02] transition-all duration-300 flex items-center justify-center gap-3"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 9l3 3m0 0l-3 3m3-3H8m13 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <span>Get Answer</span>
        </button>

      </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="hidden text-center py-8">
      <div class="inline-block">
        <svg class="animate-spin h-12 w-12 text-blue-600" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <p class="mt-4 text-gray-600 font-medium">Finding answer...</p>
      </div>
    </div>

  </div>

  <!-- Answer Modal -->
  <div id="aiModal" class="hidden fixed inset-0 z-[9999] flex items-center justify-center p-4" style="background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(8px);">
    <div class="bg-white rounded-3xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden transform transition-all">
      
      <!-- Modal Header -->
      <div class="bg-gradient-to-r from-blue-600 to-blue-700 px-8 py-6 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <h3 class="text-2xl font-bold text-white">Your Answer</h3>
        </div>
        <button id="closeModalBtn" class="text-white hover:bg-white/20 rounded-full p-2 transition">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="p-8 overflow-y-auto max-h-[calc(90vh-180px)]">
        
        <!-- Question Display -->
        <div class="mb-6 p-4 bg-blue-50 border-l-4 border-blue-500 rounded-lg">
          <p class="text-sm font-semibold text-blue-800 mb-1">Your Question:</p>
          <p id="modalQuestion" class="text-lg font-medium text-gray-800"></p>
        </div>

        <!-- Answer Display -->
        <div id="modalAnswer" class="prose prose-lg max-w-none text-gray-800 leading-relaxed whitespace-pre-wrap devanagari"></div>
      </div>

      <!-- Modal Footer -->
      <div class="bg-gray-50 px-8 py-6 flex flex-wrap items-center justify-between gap-4 border-t">
        <div class="flex flex-wrap gap-3">
          <button id="copyBtn" class="flex items-center gap-2 px-4 py-2 bg-white border-2 border-gray-300 rounded-xl hover:bg-gray-50 transition text-sm font-semibold">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
            </svg>
            Copy
          </button>
          <button id="ttsBtn" class="tts-btn bg-gradient-to-r from-green-500 to-emerald-600 text-white">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15.414A2 2 0 014 13.414V10.586A2 2 0 015.586 9l4.658-4.657A2 2 0 0112 4v16a2 2 0 01-1.757.414l-4.657-4.657z"/>
            </svg>
            <span id="ttsLabel">Listen</span>
          </button>
        </div>
        <button id="closeModalBtn2" class="px-6 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl font-semibold hover:shadow-lg transition">
          Close
        </button>
      </div>

    </div>
  </div>

  <!-- Footer -->
  <div class="text-center mt-12 pb-8">
    <div class="glass-card rounded-2xl p-6 inline-block">
      <p class="text-gray-600 font-medium mb-2">
        <span class="devanagari">üôè ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø ‡§ó‡•Ä‡§§‡§æ ‡§Æ‡§π‡•ã‡§§‡•ç‡§∏‡§µ 2025</span>
      </p>
      <p class="text-sm text-gray-500">
        Powered by AI ‚Ä¢ Last Updated: <span id="lastModified"></span>
      </p>
      <p class="text-xs text-gray-400 mt-2">
        Event Information ‚Ä¢ Official Data Only
      </p>
    </div>
  </div>

</div>

<script>
// ====================================
// MAIN CONFIGURATION
// ====================================

const N8N_WEBHOOK_URL = 'https://igmquiz-1.app.n8n.cloud/webhook/igm-chatbot-v2';

// ====================================
// QUESTIONS DATABASE - REORGANIZED
// ====================================

const questionsHindi = {
  
  // MAIN CATEGORIES
  'EVENTS': [
    "‡§ó‡•Ä‡§§‡§æ ‡§ú‡§Ø‡§Ç‡§§‡•Ä ‡§ï‡§¨ ‡§π‡•à?",
    "18000 ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡§æ ‡§ó‡•Ä‡§§‡§æ ‡§™‡§æ‡§† ‡§ï‡§¨ ‡§π‡•à?",
    "‡§ó‡•Ä‡§§‡§æ ‡§∂‡•ã‡§≠‡§æ ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?",
    "‡§¶‡•Ä‡§™ ‡§¶‡§æ‡§® ‡§∏‡§Æ‡§æ‡§∞‡•ã‡§π ‡§ï‡§¨ ‡§π‡•à?",
    "‡§ó‡•Ä‡§§‡§æ ‡§™‡§Ç‡§ö‡§æ‡§Æ‡•É‡§§ ‡§™‡•ç‡§∞‡§µ‡§ö‡§® ‡§ï‡•å‡§® ‡§¶‡•á ‡§∞‡§π‡•á ‡§π‡•à‡§Ç?",
    "‡§∏‡•ç‡§µ‡§æ‡§Æ‡•Ä ‡§∞‡§æ‡§Æ‡§≠‡§¶‡•ç‡§∞‡§æ‡§ö‡§æ‡§∞‡•ç‡§Ø ‡§ú‡•Ä ‡§ï‡§æ ‡§™‡•ç‡§∞‡§µ‡§ö‡§® ‡§ï‡§¨ ‡§π‡•à?",
    "‡§µ‡§ø‡§∞‡§æ‡§ü ‡§∏‡§Ç‡§§ ‡§∏‡§Æ‡•ç‡§Æ‡•á‡§≤‡§® ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?",
    "‡§∏‡§¶‡•ç‡§≠‡§æ‡§µ‡§®‡§æ ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡§¨ ‡§π‡•à?",
    "‡§ó‡•Ä‡§§‡§æ ‡§∏‡•ç‡§®‡§æ‡§® ‡§ï‡§¨ ‡§π‡•à?",
    "48 ‡§ï‡•ã‡§∏ ‡§§‡•Ä‡§∞‡•ç‡§• ‡§∏‡§Æ‡•ç‡§Æ‡•á‡§≤‡§® ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?",
    "‡§≠‡§æ‡§ó‡§µ‡§§ ‡§ï‡§•‡§æ ‡§ï‡§¨ ‡§π‡•à?",
    "‡§≠‡§£‡•ç‡§°‡§æ‡§∞‡§æ ‡§™‡•ç‡§∞‡§∏‡§æ‡§¶ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?",
    "‡§Æ‡§π‡§æ‡§≠‡§æ‡§∞‡§§ ‡§™‡§∞ ‡§≤‡§æ‡§á‡§ü ‡§è‡§Ç‡§° ‡§∏‡§æ‡§â‡§Ç‡§° ‡§∂‡•ã ‡§ï‡§¨ ‡§π‡•à?",
    "‡§µ‡§ø‡§∂‡•ç‡§µ‡§∞‡•Ç‡§™ ‡§°‡•ç‡§∞‡•ã‡§® ‡§∂‡•ã ‡§ï‡§¨ ‡§π‡•à?",
    "‡§∂‡§ø‡§≤‡•ç‡§™ ‡§î‡§∞ ‡§∏‡§∞‡§∏ ‡§Æ‡•á‡§≤‡§æ ‡§ï‡§π‡§æ‡§Å ‡§π‡•à?",
    "‡§ó‡•Ä‡§§‡§æ ‡§™‡•Å‡§∏‡•ç‡§§‡§ï ‡§Æ‡•á‡§≤‡§æ ‡§ï‡§¨ ‡§π‡•à?",
    "‡§∂‡§æ‡§Æ ‡§ï‡•á ‡§∏‡§æ‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§ø‡§ï ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à‡§Ç?",
    "‡§π‡§∏‡•ç‡§§‡§∂‡§ø‡§≤‡•ç‡§™ ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§®‡•Ä ‡§ï‡§π‡§æ‡§Å ‡§π‡•à?",
    "‡§Ö‡§®‡•ç‡§§‡§∞‡•ç‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø ‡§ó‡•Ä‡§§‡§æ ‡§∏‡§Ç‡§ó‡•ã‡§∑‡•ç‡§†‡•Ä ‡§ï‡§¨ ‡§π‡•à?",
    "‡§ï‡•Å‡§∞‡•Å‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§µ‡§ø‡§∂‡•ç‡§µ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§Æ‡•á‡§Ç ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§π‡•à‡§Ç?",
    "‡§Ö‡§ñ‡§ø‡§≤ ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§µ‡•à‡§¶‡§ø‡§ï ‡§∏‡§Æ‡•ç‡§Æ‡•á‡§≤‡§® ‡§ï‡§¨ ‡§π‡•à?",
    "‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§™‡•ç‡§∞‡§§‡§ø‡§Ø‡•ã‡§ó‡§ø‡§§‡§æ‡§è‡§Ç ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à‡§Ç?",
    "‡§â‡§¶‡•ç‡§ò‡§æ‡§ü‡§® ‡§∏‡§Æ‡§æ‡§∞‡•ã‡§π ‡§ï‡§¨ ‡§π‡•à?",
    "‡§Ü‡§à‡§ú‡•Ä‡§è‡§Æ 2025 ‡§ï‡§¨ ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§ó‡§æ?",
    "‡§ï‡•å‡§® ‡§∏‡•á ‡§µ‡•Ä‡§µ‡•Ä‡§Ü‡§à‡§™‡•Ä ‡§Ü ‡§∞‡§π‡•á ‡§π‡•à‡§Ç?",
    "‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Ö‡§§‡§ø‡§•‡§ø ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?",
    "‡§ï‡•å‡§® ‡§∏‡•Ä ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§®‡§ø‡§Ø‡§æ‡§Ç ‡§π‡•à‡§Ç?",
    "‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ‡§ì‡§Ç ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§®‡•Ä ‡§ï‡§π‡§æ‡§Å ‡§π‡•à?",
    "‡§ó‡•Ä‡§§‡§æ ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§Æ‡•á‡§Ç ‡§ï‡•à‡§∏‡•á ‡§≠‡§æ‡§ó ‡§≤‡•á‡§Ç?",
    "‡§ë‡§®‡§≤‡§æ‡§á‡§® ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§ï‡§¨ ‡§π‡•à?",
    "‡§®‡§ø‡§¨‡§Ç‡§ß ‡§≤‡•á‡§ñ‡§® ‡§™‡•ç‡§∞‡§§‡§ø‡§Ø‡•ã‡§ó‡§ø‡§§‡§æ ‡§ï‡§¨ ‡§π‡•à?"
  ],
  
  'GENERAL_INFO': [
    "‡§Ü‡§à‡§ú‡•Ä‡§è‡§Æ 2025 ‡§ï‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ‡•á‡§Ç ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à‡§Ç?",
    "‡§Æ‡§π‡•ã‡§§‡•ç‡§∏‡§µ ‡§ï‡§¨ ‡§∂‡•Å‡§∞‡•Ç ‡§î‡§∞ ‡§ñ‡§§‡•ç‡§Æ ‡§π‡•ã‡§ó‡§æ?",
    "‡§Ü‡§à‡§ú‡•Ä‡§è‡§Æ ‡§ï‡§ø‡§§‡§®‡•á ‡§¶‡§ø‡§® ‡§ï‡§æ ‡§π‡•à?",
    "‡§Ö‡§Ç‡§§‡§∞‡•ç‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø ‡§ó‡•Ä‡§§‡§æ ‡§Æ‡§π‡•ã‡§§‡•ç‡§∏‡§µ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?",
    "‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à‡§Ç?",
    "‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§®‡§ø‡§É‡§∂‡•Å‡§≤‡•ç‡§ï ‡§π‡•à?",
    "‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§®‡§Ç‡§¨‡§∞ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?",
    "‡§Ü‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§ï ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?"
  ],
  
  // SUBCATEGORIES
  'BY_DATE': [
    "15 ‡§®‡§µ‡§Æ‡•ç‡§¨‡§∞ ‡§ï‡•ã ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à?",
    "24 ‡§®‡§µ‡§Æ‡•ç‡§¨‡§∞ ‡§ï‡•ã ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§π‡•à‡§Ç?",
    "26 ‡§®‡§µ‡§Æ‡•ç‡§¨‡§∞ ‡§ï‡•ã ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?",
    "29 ‡§®‡§µ‡§Æ‡•ç‡§¨‡§∞ ‡§ï‡•ã ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•ã‡§ó‡§æ?",
    "30 ‡§®‡§µ‡§Æ‡•ç‡§¨‡§∞ ‡§ï‡•ã ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?",
    "1 ‡§¶‡§ø‡§∏‡§Æ‡•ç‡§¨‡§∞ ‡§ï‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?",
    "‡§¶‡•à‡§®‡§ø‡§ï ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à‡§Ç?",
    "‡§∏‡•Å‡§¨‡§π ‡§ï‡•Ä ‡§Ü‡§∞‡§§‡•Ä ‡§ï‡§æ ‡§∏‡§Æ‡§Ø?",
    "‡§∂‡§æ‡§Æ ‡§ï‡•á ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à‡§Ç?"
  ],
  
  'BY_VENUE': [
    "‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ ‡§∏‡§∞‡•ã‡§µ‡§∞ ‡§ï‡§π‡§æ‡§Å ‡§π‡•à?",
    "‡§ú‡•ç‡§Ø‡•ã‡§§‡§ø‡§∏‡§∞ ‡§ï‡§π‡§æ‡§Å ‡§π‡•à?",
    "‡§∏‡§®‡•ç‡§®‡§ø‡§π‡§ø‡§§ ‡§∏‡§∞‡•ã‡§µ‡§∞ ‡§™‡§∞ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à?",
    "‡§™‡•Å‡§∞‡•Å‡§∑‡•ã‡§§‡•ç‡§§‡§Æ‡§™‡•Å‡§∞‡§æ ‡§¨‡§æ‡§ó ‡§ï‡§π‡§æ‡§Å ‡§π‡•à?",
    "‡§ï‡•á‡§∂‡§µ ‡§™‡§æ‡§∞‡•ç‡§ï ‡§ï‡§π‡§æ‡§Å ‡§π‡•à?",
    "‡§≤‡§æ‡§á‡§ü ‡§∂‡•ã ‡§ï‡§π‡§æ‡§Å ‡§π‡•ã‡§ó‡§æ?",
    "‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ ‡§∏‡§∞‡•ã‡§µ‡§∞ ‡§™‡§∞ ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§π‡•à‡§Ç?",
    "‡§ú‡•ç‡§Ø‡•ã‡§§‡§ø‡§∏‡§∞ ‡§ï‡•à‡§∏‡•á ‡§™‡§π‡•Å‡§Ç‡§ö‡•á‡§Ç?"
  ],
  
  'RELIGIOUS_PROGRAMS': [
    "‡§∏‡•Å‡§¨‡§π ‡§ï‡•Ä ‡§Ü‡§∞‡§§‡•Ä ‡§ï‡§æ ‡§∏‡§Æ‡§Ø?",
    "‡§∂‡§æ‡§Æ ‡§ï‡•Ä ‡§Ü‡§∞‡§§‡•Ä ‡§ï‡§¨ ‡§π‡•à?",
    "‡§ó‡•Ä‡§§‡§æ ‡§™‡§æ‡§† ‡§ï‡§¨ ‡§π‡•ã‡§§‡§æ ‡§π‡•à?",
    "‡§Ø‡§ú‡•ç‡§û ‡§ï‡§π‡§æ‡§Å ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à?",
    "‡§≠‡§ú‡§® ‡§∏‡§Ç‡§ß‡•ç‡§Ø‡§æ ‡§ï‡§æ ‡§∏‡§Æ‡§Ø?",
    "‡§™‡•ç‡§∞‡§µ‡§ö‡§® ‡§ï‡•å‡§® ‡§¶‡•á ‡§∞‡§π‡•á ‡§π‡•à‡§Ç?",
    "‡§∏‡§Ç‡§§ ‡§∏‡§Æ‡•ç‡§Æ‡•á‡§≤‡§® ‡§Æ‡•á‡§Ç ‡§ï‡•å‡§® ‡§Ü‡§è‡§Ç‡§ó‡•á?",
    "‡§¶‡•à‡§®‡§ø‡§ï ‡§™‡•Ç‡§ú‡§æ ‡§ï‡§æ ‡§∏‡§Æ‡§Ø?"
  ],
  
  'CULTURAL_ACTIVITIES': [
    "‡§≤‡§æ‡§á‡§ü ‡§∂‡•ã ‡§ï‡§æ ‡§∏‡§Æ‡§Ø?",
    "‡§°‡•ç‡§∞‡•ã‡§® ‡§∂‡•ã ‡§ï‡§¨ ‡§π‡•à?",
    "‡§∏‡§æ‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§ø‡§ï ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ï‡§¨ ‡§π‡•à‡§Ç?",
    "‡§∏‡§Ç‡§ó‡•Ä‡§§ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ï‡§¨ ‡§π‡•à?",
    "‡§®‡•É‡§§‡•ç‡§Ø ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§® ‡§ï‡§¨ ‡§π‡•à?",
    "‡§™‡•Å‡§∏‡•ç‡§§‡§ï ‡§Æ‡•á‡§≤‡§æ ‡§ï‡§π‡§æ‡§Å ‡§π‡•à?",
    "‡§π‡§∏‡•ç‡§§‡§∂‡§ø‡§≤‡•ç‡§™ ‡§Æ‡•á‡§≤‡§æ ‡§ï‡§¨ ‡§π‡•à?"
  ]
  
};

const questionsEnglish = {
  
  // MAIN CATEGORIES
  'EVENTS': [
    "When is Gita Jayanti?",
    "When is the 18000 students Gita recitation?",
    "What is Gita Shobha Yatra?",
    "When is the Deep Daan ceremony?",
    "Who is giving Gita Panchamrit discourse?",
    "When is Swami Rambhadracharya's discourse?",
    "What is Virat Sant Sammelan?",
    "When is Sadbhavana Yatra?",
    "When is Gita Snan?",
    "What is 48 Kos Teerth Sammelan?",
    "When is Bhagavat Katha?",
    "What is Bhandara Prasad?",
    "When is the Light and Sound Show on Mahabharata?",
    "When is the Vishwaroop Drone Show?",
    "Where is Shilp and Saras Mela?",
    "When is the Gita Book Fair?",
    "What are the evening cultural programs?",
    "Where is the handicrafts exhibition?",
    "When is the International Gita Seminar?",
    "What programs are at Kurukshetra University?",
    "When is the All India Vedic Conference?",
    "What are the student competitions?",
    "When is the opening ceremony?",
    "When will IGM 2025 start?",
    "Which VVIPs are coming?",
    "Who is the chief guest?",
    "What exhibitions are there?",
    "Where is the institutions exhibition?",
    "How to participate in Gita Quiz?",
    "When is the online quiz?",
    "When is the essay writing competition?"
  ],
  
  'GENERAL_INFO': [
    "What are the dates of IGM 2025?",
    "When does the festival start and end?",
    "How many days is IGM?",
    "What is International Gita Mahotsav?",
    "What are the main programs?",
    "Is entry free?",
    "What is the contact number?",
    "What is the official website?"
  ],
  
  // SUBCATEGORIES
  'BY_DATE': [
    "What's happening on November 15?",
    "What programs on November 24?",
    "What's on November 26?",
    "What will happen on November 29?",
    "What's on November 30?",
    "What's the December 1 program?",
    "What are the daily programs?",
    "Morning aarti timing?",
    "What are evening programs?"
  ],
  
  'BY_VENUE': [
    "Where is Brahma Sarovar?",
    "Where is Jyotisar?",
    "What's happening at Sannihit Sarovar?",
    "Where is Purushottampura Bagh?",
    "Where is Keshav Park?",
    "Where will the light show be?",
    "What programs at Brahma Sarovar?",
    "How to reach Jyotisar?"
  ],
  
  'RELIGIOUS_PROGRAMS': [
    "Morning aarti timing?",
    "When is evening aarti?",
    "When is Gita Path?",
    "Where is the Yagya?",
    "Bhajan Sandhya timing?",
    "Who is giving discourse?",
    "Who will come to Sant Sammelan?",
    "Daily puja timing?"
  ],
  
  'CULTURAL_ACTIVITIES': [
    "Light show timing?",
    "When is drone show?",
    "When are cultural programs?",
    "When is music program?",
    "When is dance performance?",
    "Where is book fair?",
    "When is handicrafts mela?"
  ]
  
};

// ====================================
// GLOBAL VARIABLES
// ====================================

let currentLanguage = 'Hindi';
let currentQuestions = questionsHindi;
let allQuestions = [];
let recognition = null;
let speechSynthesis = window.speechSynthesis;
let currentUtterance = null;

// ====================================
// DOM ELEMENTS
// ====================================

const userInput = document.getElementById('userInput');
const submitBtn = document.getElementById('submitBtn');
const micBtn = document.getElementById('micBtn');
const loadingIndicator = document.getElementById('loadingIndicator');
const autocompleteDropdown = document.getElementById('autocompleteDropdown');
const categorySelect = document.getElementById('categorySelect');
const questionSelect = document.getElementById('questionSelect');
const ttsBtn = document.getElementById('ttsBtn');
const ttsLabel = document.getElementById('ttsLabel');

// ====================================
// INITIALIZATION
// ====================================

function initializeQuestions() {
  // Clear dropdown
  categorySelect.innerHTML = '<option value="" selected disabled>Select Topic</option>';
  
  // Populate categories
  Object.keys(currentQuestions).forEach(category => {
    const option = document.createElement('option');
    option.value = category;
    option.textContent = formatCategoryName(category);
    categorySelect.appendChild(option);
  });
  
  // Build flattened question list for autocomplete
  allQuestions = [];
  Object.keys(currentQuestions).forEach(category => {
    currentQuestions[category].forEach(question => {
      allQuestions.push({
        question: question,
        category: formatCategoryName(category)
      });
    });
  });
}

function formatCategoryName(category) {
  // Format category names nicely
  return category.replace(/_/g, ' ')
    .split(' ')
    .map(word => word.charAt(0) + word.slice(1).toLowerCase())
    .join(' ');
}

// ====================================
// AUTOCOMPLETE - FIXED FOR 3-4 CHARS
// ====================================

function highlightMatch(text, query) {
  const regex = new RegExp(`(${query})`, 'gi');
  return text.replace(regex, '<mark>$1</mark>');
}

function filterQuestions(query) {
  // FIXED: Changed from 2 to 1 character minimum
  if (!query || query.length < 1) {
    return [];
  }
  
  query = query.toLowerCase().trim();
  const keywords = query.split(/\s+/);
  
  // Better matching logic for 3-4 character searches
  return allQuestions.filter(item => {
    const questionLower = item.question.toLowerCase();
    
    // If query is 3-4 chars, look for word boundaries or consecutive matches
    if (query.length >= 3 && query.length <= 4) {
      // Check if query appears as a complete word or at word start
      const wordBoundaryMatch = new RegExp(`\\b${query}`, 'i').test(questionLower);
      // Check if query appears consecutively anywhere
      const consecutiveMatch = questionLower.includes(query);
      
      return wordBoundaryMatch || consecutiveMatch;
    }
    
    // For longer queries, use keyword matching
    return keywords.some(keyword => questionLower.includes(keyword));
  }).slice(0, 8); // Show max 8 suggestions
}

userInput.addEventListener('input', function() {
  const query = this.value.trim();
  
  // FIXED: Changed from 2 to 1 character minimum
  if (query.length < 1) {
    autocompleteDropdown.style.display = 'none';
    return;
  }
  
  const matches = filterQuestions(query);
  
  if (matches.length === 0) {
    autocompleteDropdown.innerHTML = '<div class="autocomplete-no-results">No matching questions found. Try different keywords.</div>';
    autocompleteDropdown.style.display = 'block';
    return;
  }
  
  let html = '';
  let lastCategory = '';
  
  matches.forEach(item => {
    if (item.category !== lastCategory) {
      html += `<div class="autocomplete-category">${item.category}</div>`;
      lastCategory = item.category;
    }
    
    const highlightedQuestion = highlightMatch(item.question, query);
    html += `<div class="autocomplete-item" data-question="${item.question}">${highlightedQuestion}</div>`;
  });
  
  autocompleteDropdown.innerHTML = html;
  autocompleteDropdown.style.display = 'block';
  
  // Add click handlers
  document.querySelectorAll('.autocomplete-item').forEach(item => {
    item.addEventListener('click', function() {
      userInput.value = this.getAttribute('data-question');
      autocompleteDropdown.style.display = 'none';
    });
  });
});

// Close dropdown when clicking outside
document.addEventListener('click', function(e) {
  if (!userInput.contains(e.target) && !autocompleteDropdown.contains(e.target)) {
    autocompleteDropdown.style.display = 'none';
  }
});

// Close dropdown on ESC key
userInput.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    autocompleteDropdown.style.display = 'none';
  }
});

// ====================================
// CATEGORY & QUESTION DROPDOWNS
// ====================================

categorySelect.addEventListener('change', function() {
  questionSelect.innerHTML = '<option value="" selected disabled>Select Question</option>';
  questionSelect.disabled = false;
  
  const selectedCategory = this.value;
  if (currentQuestions[selectedCategory]) {
    currentQuestions[selectedCategory].forEach(question => {
      const option = document.createElement('option');
      option.value = question;
      option.textContent = question;
      questionSelect.appendChild(option);
    });
  }
});

questionSelect.addEventListener('change', function() {
  userInput.value = this.value;
  autocompleteDropdown.style.display = 'none';
});

// ====================================
// LANGUAGE TOGGLE
// ====================================

document.querySelectorAll('.langBtn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.langBtn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
    
    currentLanguage = this.getAttribute('data-lang');
    currentQuestions = currentLanguage === 'Hindi' ? questionsHindi : questionsEnglish;
    
    initializeQuestions();
    
    // Update placeholders
    if (currentLanguage === 'Hindi') {
      userInput.placeholder = 'e.g., ‡§ó‡•Ä‡§§‡§æ ‡§ú‡§Ø‡§Ç‡§§‡•Ä ‡§ï‡§¨ ‡§π‡•à?';
    } else {
      userInput.placeholder = 'e.g., When is Gita Jayanti?';
    }
  });
});

// ====================================
// VOICE RECOGNITION
// ====================================

if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
  
  micBtn.addEventListener('click', function() {
    if (micBtn.classList.contains('recording')) {
      recognition.stop();
      micBtn.classList.remove('recording');
    } else {
      recognition.lang = currentLanguage === 'Hindi' ? 'hi-IN' : 'en-US';
      recognition.start();
      micBtn.classList.add('recording');
    }
  });
  
  recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript;
    userInput.value = transcript;
    micBtn.classList.remove('recording');
  };
  
  recognition.onerror = function(event) {
    console.error('Speech recognition error:', event.error);
    micBtn.classList.remove('recording');
    alert('Voice recognition error. Please try again.');
  };
  
  recognition.onend = function() {
    micBtn.classList.remove('recording');
  };
} else {
  micBtn.style.display = 'none';
}

// ====================================
// TEXT-TO-SPEECH - FIXED
// ====================================

ttsBtn.addEventListener('click', function() {
  const answerText = document.getElementById('modalAnswer').textContent;
  
  if (ttsBtn.classList.contains('speaking')) {
    // Stop speaking
    speechSynthesis.cancel();
    ttsBtn.classList.remove('speaking');
    ttsLabel.textContent = 'Listen';
  } else {
    // Start speaking
    speechSynthesis.cancel(); // Cancel any ongoing speech
    
    currentUtterance = new SpeechSynthesisUtterance(answerText);
    currentUtterance.lang = currentLanguage === 'Hindi' ? 'hi-IN' : 'en-US';
    currentUtterance.rate = 0.9;
    currentUtterance.pitch = 1;
    
    currentUtterance.onstart = function() {
      ttsBtn.classList.add('speaking');
      ttsLabel.textContent = 'Speaking...';
    };
    
    currentUtterance.onend = function() {
      ttsBtn.classList.remove('speaking');
      ttsLabel.textContent = 'Listen';
    };
    
    currentUtterance.onerror = function() {
      ttsBtn.classList.remove('speaking');
      ttsLabel.textContent = 'Listen';
    };
    
    speechSynthesis.speak(currentUtterance);
  }
});

// ====================================
// MAIN QUERY HANDLER
// ====================================

async function handleQuery() {
  const question = userInput.value.trim();
  
  if (!question) {
    alert(currentLanguage === 'Hindi' 
      ? '‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§' 
      : 'Please enter a question.');
    return;
  }
  
  // Hide main container and show loading
  const mainContainer = document.querySelector('.container-main');
  if (mainContainer) mainContainer.style.visibility = 'hidden';
  document.getElementById('aiModal').classList.remove('hidden');
  document.getElementById('modalAnswer').innerHTML = '<div class="text-center py-8"><svg class="animate-spin h-12 w-12 text-blue-600 mx-auto" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><p class="mt-4 text-gray-600 font-medium">Finding answer...</p></div>';
  document.getElementById('modalQuestion').textContent = question;
  
  try {
    const response = await fetch(N8N_WEBHOOK_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        question: question,
        language: currentLanguage
      })
    });
    
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    
    const data = await response.json();
    const answer = data.response || data.answer || 'No answer received.';
    
    document.getElementById('modalAnswer').textContent = answer;
    
  } catch (error) {
    console.error('Error:', error);
    document.getElementById('modalAnswer').textContent = 
      currentLanguage === 'Hindi'
        ? '‚ùå ‡§ï‡•ç‡§∑‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç, ‡§è‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§'
        : '‚ùå Sorry, an error occurred. Please try again.';
  }
}

submitBtn.addEventListener('click', handleQuery);
userInput.addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    handleQuery();
  }
});

// ====================================
// MODAL CONTROLS
// ====================================

document.getElementById('closeModalBtn').onclick = () => {
  speechSynthesis.cancel(); // Stop any ongoing TTS
  document.getElementById('aiModal').classList.add('hidden');
  const mainContainer = document.querySelector('.container-main');
  if (mainContainer) mainContainer.style.visibility = 'visible';
};

document.getElementById('closeModalBtn2').onclick = () => {
  speechSynthesis.cancel(); // Stop any ongoing TTS
  document.getElementById('aiModal').classList.add('hidden');
  const mainContainer = document.querySelector('.container-main');
  if (mainContainer) mainContainer.style.visibility = 'visible';
};

// ====================================
// COPY BUTTON - FIXED
// ====================================

document.getElementById('copyBtn').onclick = () => {
  const text = document.getElementById('modalAnswer').textContent;
  
  // Modern clipboard API with fallback
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text).then(() => {
      const btn = document.getElementById('copyBtn');
      const originalHTML = btn.innerHTML;
      btn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Copied!';
      btn.classList.add('bg-green-500', 'text-white', 'border-green-500');
      setTimeout(() => { 
        btn.innerHTML = originalHTML;
        btn.classList.remove('bg-green-500', 'text-white', 'border-green-500');
      }, 2000);
    }).catch(err => {
      console.error('Clipboard error:', err);
      // Fallback to old method
      fallbackCopyText(text);
    });
  } else {
    // Fallback for older browsers
    fallbackCopyText(text);
  }
};

// Fallback copy function
function fallbackCopyText(text) {
  const textArea = document.createElement('textarea');
  textArea.value = text;
  textArea.style.position = 'fixed';
  textArea.style.left = '-999999px';
  document.body.appendChild(textArea);
  textArea.select();
  
  try {
    document.execCommand('copy');
    const btn = document.getElementById('copyBtn');
    const originalHTML = btn.innerHTML;
    btn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Copied!';
    btn.classList.add('bg-green-500', 'text-white', 'border-green-500');
    setTimeout(() => { 
      btn.innerHTML = originalHTML;
      btn.classList.remove('bg-green-500', 'text-white', 'border-green-500');
    }, 2000);
  } catch (err) {
    alert('Copy failed. Please copy manually.');
  }
  
  document.body.removeChild(textArea);
}

// ====================================
// MUSIC TOGGLE
// ====================================

const fluteMusic = document.getElementById('fluteMusic');
const musicToggle = document.getElementById('musicToggle');
const musicLabel = document.getElementById('musicLabel');

musicToggle.addEventListener('click', () => {
  if (fluteMusic.paused) {
    fluteMusic.play().catch(e => {
      alert("Please interact with the page first, then click to play music.");
    });
    musicLabel.textContent = "üîá Pause Flute";
  } else {
    fluteMusic.pause();
    musicLabel.textContent = "üéµ Play Flute Music";
  }
});

// ====================================
// LAST MODIFIED DATE
// ====================================

window.addEventListener('DOMContentLoaded', () => {
  const lastModifiedDate = new Date(document.lastModified);
  const element = document.getElementById("lastModified");
  if (element) {
    element.textContent = lastModifiedDate.toLocaleDateString('en-US', {
      year: 'numeric', month: 'long', day: 'numeric'
    }) + ' at ' + lastModifiedDate.toLocaleTimeString('en-US', {
      hour: '2-digit', minute: '2-digit'
    });
  }
  
  // Initialize questions on load
  initializeQuestions();
});

</script>

</body>
</html>
